### 对于select和poll来说，所有文件描述符都是在用户态被加入其文件描述符集合的，每次调用都需要将整个集合拷贝到内核态。



这句话描述了 select 和 poll 这两个 I/O 多路复用的系统调用在处理文件描述符集合时的一种机制。让我们一步一步解释：

- 1.文件描述符集合： 在 select 和 poll 中，你需要提供用于监听的文件描述符集合。这个集合是一个位掩码或数组，表示你希望监视的文件描述符。这些文件描述符通常是套接字、文件、管道等 I/O 对象。
- 2.用户态和内核态： 操作系统分为用户态和内核态。用户态是指应用程序运行的环境，而内核态是指操作系统内核运行的环境。**在用户态，应用程序可以执行一些基本的计算任务，但是对于底层硬件和系统资源的直接访问需要通过系统调用来实现，这时就会切换到内核态。**
- 3.拷贝文件描述符集合： 当你调用 select 或 poll 时，**你需要将文件描述符集合传递给内核，以便内核知道哪些文件描述符需要监听。这就涉及到用户态到内核态的切换**。为了将文件描述符集合传递给内核，操作系统需要将这些信息从用户态的内存复制到内核态的内存。
- 4.每次调用都需要拷贝： 文中提到 "每次调用都需要将整个集合拷贝到内核态" 意味着每次你调用 select 或 poll，都需要将整个文件描述符集合的信息从用户态拷贝到内核态。这可能导致一些**性能开销**，特别是在文件描述符集合很大时。

这种拷贝机制是 select 和 poll 在设计上的一种局限。相比之下，后来的 I/O 多路复用机制如 epoll 在这方面进行了改进，它使用了更为高效的事件通知机制，避免了每次调用都需要拷贝整个文件描述符集合的问题。这些改进使得 **epoll 在大规模连接的高并发场景下性能更好**。